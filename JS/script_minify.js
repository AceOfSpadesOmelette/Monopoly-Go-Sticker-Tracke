import{STICKER_DATA as e}from"../Database/StickerData.js";import{SET_DATA as t}from"../Database/SetData.js";import{ALBUM_DATA as r}from"../Database/AlbumData.js";import{NEWS_DATA as n}from"../Database/NewsData.js";import{LANGUAGE_DICTIONARY as a}from"../Database/LanguageDictionary.js";let DefaultCSSSheet=document.getElementById("DefaultCSS"),MobileCSSSheet=document.getElementById("MobileCSS"),MiddleSideBlock=document.getElementById("middle-side"),CurrentStickerBoardBlock=document.querySelector("#sticker-board #current-sticker-board"),BasicMenuNewsBtnComponent=document.getElementById("BasicMenuNewsBtn"),LoadingOverlayBlock=document.getElementById("loading-overlay"),IgnorePrestigeBtnComponent=document.getElementById("IgnorePrestigeBtn"),SortOrderBtnComponent=document.getElementById("SortOrderBtn"),FilterMenuSearchBarComponent=document.getElementById("filtermenu-searchbar"),ClearFiltersBtnComponent=document.getElementById("ClearFiltersBtn"),RefreshFiltersBtnComponent=document.getElementById("RefreshFiltersBtn"),AndOrFilterModeBtnComponent=document.getElementById("AndOrFilterModeBtn"),SpareFilterMinInputComponent=document.getElementById("spare-filter-min"),SpareFilterMaxInputComponent=document.getElementById("spare-filter-max"),SpareFilterBtnComponent=document.getElementById("spare-filter-btn"),PlayerIGNInputComponent=document.getElementById("player-ign"),PlayerLinkInputComponent=document.getElementById("player-link"),LeftoverVaultStarsInputComponent=document.getElementById("leftover-total-vault-quantity"),AlbumIconContainerBlock=document.getElementById("album-logo-container"),SetImageOrientationBtnComponent=document.getElementById("SetImageOrientationBtn"),IncludePlayerIGNBtnComponent=document.getElementById("IncludeIGNBtn"),IncludePlayerLinkBtnComponent=document.getElementById("IncludePlayerLinkBtn"),dlPngButtonComponent=document.getElementById("dl-png"),CollectionScreenshotBlock=document.getElementById("collection-screenshot"),TradeScreenshotBlock=document.getElementById("trade-screenshot"),SnapshotAreaBlock=document.getElementById("trade-screenshot"),dlTradePngButtonComponent=document.getElementById("dl-trade-png"),TradeScreenshotContainerBlock=document.getElementById("trade-screenshot-container"),ForTradeScreenshotAreaBlock=document.getElementById("fortrade-screenshot-area"),LookingForScreenshotAreaBlock=document.getElementById("lookingfor-screenshot-area"),ViewportBtnComponent=document.getElementById("ViewportBtn"),LayoutBtnComponent=document.getElementById("LayoutBtn"),CurrentFiltersContentBlock=document.getElementById("current-filters-content"),GenerateTradePostBtnComponent=document.getElementById("generate-trade-post-btn"),ToggleSelectedBtnComponent=document.getElementById("ToggleSelectedBtn"),ResetSparesBtnComponent=document.getElementById("ResetSparesBtn"),ToggleLFBtnComponent=document.getElementById("ToggleLFBtn"),ToggleFTBtnComponent=document.getElementById("ToggleFTBtn"),ResetLFBtnComponent=document.getElementById("ToggleLFBtn"),ResetFTBtnComponent=document.getElementById("ToggleFTBtn"),ResetAllStickersBtnComponent=document.getElementById("ResetAllStickersBtn"),NewsContentBlock=document.getElementById("news-content"),ChangeStickerStyleBtnComponent=document.getElementById("ChangeStickerStyleBtn"),ProfileListBlock=document.getElementById("profile-list"),SetProgressTrackerBlock=document.getElementById("set-progress-tracker"),ImportBtnComponent=document.getElementById("import-btn"),ImportFromFileBtnComponent=document.getElementById("import-from-file-btn"),ExportBtnComponent=document.getElementById("export-btn"),ExportFromFileBtnComponent=document.getElementById("export-from-file-btn"),ProfileTextAreaComponent=document.getElementById("backup-area"),vaultTierImage=document.querySelector(".vault-tier"),TradePostTextAreaComponent=document.querySelector(".trade-post-area"),CopyTradePostAreaBtnComponent=document.getElementById("copy-trade-post-area"),ManageProfileImg=document.querySelector(".ManageProfileImg"),ChangeAlbumMenuBlock=document.getElementById("change-album-menu"),FilterSortModal=document.getElementById("filter-sort-modal"),FilterSortMenuMobileOpenBtn=document.getElementById("mobileMenuFilters"),FilterSortMenuMobileCloseBtn=document.getElementById("filter-sort-menu-footer"),ProgressMenuModal=document.getElementById("progress-menu-modal"),ProgressMenuMobileOpenBtn=document.getElementById("mobileMenuOptions"),ProgressMenuMobileCloseBtn=document.getElementById("progress-menu-footer"),CurrentFiltersModal=document.getElementById("current-filters-modal"),CurrentFiltersOpenBtn=document.getElementById("ViewCurrentFiltersBtn"),CurrentFiltersCloseBtn=document.getElementById("current-filters-footer"),ManageProfileModal=document.getElementById("manage-profile-modal"),ManageProfileOpenBtn=document.getElementById("ManageProfileBtn"),ManageProfileCloseBtn=document.getElementById("manage-profile-footer"),BasicMenuModal=document.getElementById("basic-menu-modal"),BasicMenuMobileOpenBtn=document.getElementById("mobileBasicMenu"),BasicMenuWebOpenBtn=document.getElementById("webBasicMenu"),BasicMenuMobileCloseBtn=document.getElementById("basic-menu-footer"),ButtonGroupTitleElementGroup=document.querySelectorAll(".btn-grp-title"),AccordionElementGroup=document.querySelectorAll(".accordion"),BasicMenuNavBtnElementGroup=document.querySelectorAll(".basic-menu-nav-btn"),BasicMenuSubcontainerElementGroup=document.querySelectorAll(".basic-menu-subcontainer"),SortBtnElementGroup=document.querySelectorAll(".sort-btn"),FilterBtnElementGroup=document.querySelectorAll(".filter-btn"),TradeButtonContainerBtnGroup=document.querySelectorAll(".trade-button-container .btn"),StaticButtonsGroup=document.querySelectorAll(".btn"),LanguageButtons=document.querySelectorAll(".translation-btn"),TranslationElements=document.querySelectorAll("[data-translation-key]"),TierOneVaultQuantitySpan=document.getElementById("TierOneVaultQuantity"),TierTwoVaultQuantitySpan=document.getElementById("TierTwoVaultQuantity"),TierThreeVaultQuantitySpan=document.getElementById("TierThreeVaultQuantity"),SortOrderBtnTextSpan=document.getElementById("SortOrderBtnText"),FilterLengthTextSpan=document.getElementById("filterLength"),AndOrFilterModeBtnTextSpan=document.getElementById("AndOrFilterModeBtnText"),AndOrFilterModeBtnTooltipTextSpan=document.getElementById("AndOrFilterModeBtnTooltip"),TotalGoldQuantityTextSpan=document.getElementById("total-gold-quantity"),GoldQuantityTextSpan=document.getElementById("gold-quantity"),GoldPercentageTextSpan=document.getElementById("gold-percentage"),NextVaultCounterTextSpan=document.getElementById("NextVaultCounter"),ViewportBtnTextSpan=document.getElementById("ViewportBtnText"),LayoutBtnTextSpan=document.getElementById("LayoutBtnText"),ChangeStickerStyleBtnTextSpan=document.getElementById("ChangeStickerStyleBtnText"),TotalStickersQuantityTextSpan=document.getElementById("total-stickers-quantity"),UserStickersQuantityTextSpan=document.getElementById("user-stickers-quantity"),TotalVaultQuantityTextSpan=document.getElementById("total-vault-quantity"),StartTimeTextSpan=document.getElementById("start-time"),EndTimeTextSpan=document.getElementById("end-time"),TimeLeftTextSpan=document.getElementById("time-left"),CopyTradePostAreaBtnTextSpan=document.getElementById("copy-trade-post-area-btn-text"),CurrentAlbumNumber=getCurrentAlbumNumber(),VaultTierOne=250,VaultTierTwo=500,VaultTierThree=700,userData={},UserProfileList=JSON.parse(localStorage.getItem("UserProfileList"))||[],FilterList={},AndZeroOrOne=0,AscendZeroDescendOne=0,IgnorePrestige=0,WebZeroMobileOne=0,LightZeroDarkOne=0,ImgOrientationLandscapeZeroPortraitOne=0,StickerSelectedZeroShowOneBack=0,CurrentLanguageCode="EN",defaultValues={id:"0",selected:0,spare:0,show:1,havespare:0,lookingfor:0,fortrade:0};function init(t){InsertVaultTierQuantity(),GenerateFilterSetButtons(),GenerateChangeAlbumButtons(),SetDefaultFilterStates(),document.querySelector(`button[data-translation-pointer= ${CurrentLanguageCode}]`).click();let r=localStorage.getItem("userData");r?(importUserData(r),ProfileTextAreaComponent.value=r):CreateNewUserData(e),generateCurrentStickerBoard(e,userData,"current-sticker-board"),PerformSort({currentTarget:document.querySelector("button[data-sort-type='GlobalID']")}),NotSelectedByDefault(),UpdateTotalStickerQuantity(),UpdateTotalStickerByRarityQuantity(),countSelectedStickers(),countVaultStickers(),handleBasicMenuNavigationClick({target:BasicMenuNewsBtnComponent});let n=document.querySelectorAll(".change-album-btn");n.forEach(e=>{let t=e.getAttribute("data-album-number");t===CurrentAlbumNumber&&e.classList.add("btnBlue")}),UpdateAlbumStartEndTime(),t()}function getCurrentAlbumNumber(){let e=Math.floor(Date.now()/1e3),t=0,n="";for(let a=0;a<r.length;a++){let o=r[a],l=parseInt(o.StartTime);l<=e&&(l>t||0===t)&&(t=l,n=o.AlbumNo)}if(""===n){let s=0;for(let c=0;c<r.length;c++){let u=r[c],d=parseInt(u.AlbumNo);d>s&&(s=d)}n=s.toString()}return n}function InsertVaultTierQuantity(){TierOneVaultQuantitySpan.textContent=250,TierTwoVaultQuantitySpan.textContent=500,TierThreeVaultQuantitySpan.textContent=700}function SetDefaultFilterStates(){let e=document.querySelectorAll("[data-filtervalue]");e.forEach(e=>{let t=e.getAttribute("data-filtervalue"),r=t.split(">")[1],n=t.split(">")[2];n.includes("|")&&(n=n.split("|")),FilterList[t]={inDatabase:t.split(">")[0],FilterName:t,FilterKey:r,FilterValue:n,FilterState:0}})}function CreateNewUserData(e){userData={},e.filter(e=>e.AlbumNo===CurrentAlbumNumber).forEach(e=>{let t={...defaultValues,id:e.GlobalID};userData[e.GlobalID]=t})}function NotSelectedByDefault(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{e.classList.contains("selected")||e.classList.add("not-selected"),ApplySelectedStyle(e)})}function generateCurrentStickerBoard(t,r,n){let a=document.getElementById(n),o=document.createDocumentFragment();for(let l of t.filter(e=>e.GlobalID in r)){let s=r[l.GlobalID],c=s.id,u=document.querySelector(`.sticker-card-container[data-global][data-global="${c}"]`),d=e.find(e=>e.GlobalID===c);if(1===IgnorePrestige&&"1"===d.Prestige){u&&u.remove();continue}if(1===s.show){if(!u){let p=CreateStickerElement(l,"sticker-card-container","sticker-card",!0);o.appendChild(p)}}else 0===s.show&&u&&u.remove()}a.appendChild(o)}function getStickerClasses(e,t){let r="sticker-name";return e.length>14&&(r="sticker-name-long-min14"),e.length>18&&(r="sticker-name-long-min18"),isBrighterThan(t,"#CCCCCC")&&(r+="-dark"),r}function getFrameHTML(e){return"1"===e?'<img draggable="false" class="gold-frame" src="assets/stickers/BG_StickerSpecial.png">':'<img draggable="false" class="normal-frame" src="assets/stickers/BG_StickerBasic.png">'}function getRibbonStyle(e,t,r){return`background: ${t}; 
          background: -moz-linear-gradient(90deg, ${t} 0%, ${e} 10%, ${e} 90%, ${t} 100%); 
          background: -webkit-linear-gradient(90deg, ${t} 0%, ${e} 10%, ${e} 90%, ${t} 100%); 
          background: linear-gradient(90deg, ${t} 0%, ${e} 10%, ${e} 90%, ${t} 100%); 
          border: 2px solid ${r};`}function createStickerInnerHTML(e,t,r,n,a,o,l,s,c,u,d,p){return`
    <div class="sticker-structure-container">
      <div class="sticker-star-container">
        <img draggable="false" class="star-img" src="assets/stickers/Collections_Star_${p}Star.png">
      </div>
      <div class="sticker-photo-container">
        <img draggable="false" class="${c}" src="stickers/${u}/${d}">
        ${r}
      </div>
      <div class="sticker-ribbon" style="${n}">
        <span class="${t}">
          <span>
            <span data-translation-key="set">${a}</span>&nbsp;${o}&ensp;#${l}
          </span>
          <span class="StickerNameText" data-stickerid="${s}"></span>
        </span>
      </div>
    </div>`}function CreateStickerElement(e,t,r,n){let{SetID:o,AlbumNo:l,GlobalID:s,AlbumName:c,Golden:u,StickerRarity:d,ImageSource:p,Colour:g}=e,m=e[`StickerName${CurrentLanguageCode}`],f=DarkenColour(g,15),S=DarkenColour(g,5),y=getStickerClasses(m,g),b=getFrameHTML(u),C=getRibbonStyle(g,S,f),B=a.find(e=>"set"===e["translation-key"])[CurrentLanguageCode],L=document.createElement("div");return L.dataset.global=s,L.classList.add(t),L.innerHTML=createStickerInnerHTML(e,y,b,C,B,o-100*l,s-100*o,s,r,c,p,d),n&&(appendSpareSpinner(L),appendTradeButtons(L),RestoreSelected(userData,L),RestoreStickerSpares(userData,L),RestoreTradeStates(userData,L)),L}function ApplySelectedStyle(t){let r=e.find(e=>e.GlobalID===t.getAttribute("data-global")),{SetID:n,AlbumNo:o,GlobalID:l,AlbumName:s,Golden:c,StickerRarity:u,ImageSource:d,Colour:p}=r,g=r[`StickerName${CurrentLanguageCode}`],m=userData[r.GlobalID],f=t.querySelector(".sticker-structure-container"),S=n-100*o,y=l-100*n,b=DarkenColour(p,15),C=DarkenColour(p,5),B=getStickerClasses(g,p),L=getFrameHTML(c),h=getRibbonStyle(p,C,b),T=a.find(e=>"set"===e["translation-key"])[CurrentLanguageCode];f.innerHTML=createStickerInnerHTML(r,B,L,h,T,S,y,l,"sticker-card",s,d,u),0===m.selected&&1===StickerSelectedZeroShowOneBack&&(f.innerHTML=`
      <div class="sticker-star-container">
        <img draggable="false" class="star-img" src="assets/stickers/Collections_Star_${u}Star_Grey.png">
      </div>
      <div class="sticker-photo-container">
        <img draggable="false" class="sticker-card" src="${"1"===c?"assets/stickers/CardBack_Special.png":"assets/stickers/CardBack_Basic_0.png"}">
      </div>
      <div class="sticker-ribbon-transparent">
        <span class="${B}" style="color: #9a9381;">
          <span>
            <span data-translation-key="set">${T}</span>&nbsp;${S}&ensp;#${y}
          </span>
          <span class="StickerNameText" data-stickerid="${l}"></span>
        </span>
      </div>`),t.style.opacity=0===m.selected&&0===StickerSelectedZeroShowOneBack?"0.4":"1.0",t.style.transition="0.1s",TranslateStickerName(t,CurrentLanguageCode);let $=t.querySelector(".spare-spinner-container");if(0===StickerSelectedZeroShowOneBack)$.style.marginTop="5.5px";else if(1===StickerSelectedZeroShowOneBack){if(0===WebZeroMobileOne)$.style.marginTop=0===m.selected?"55px":"6.5px";else if(1===WebZeroMobileOne){let v=t.querySelector(".sticker-ribbon-transparent");0===m.selected?(v.style.marginTop="-5.4rem",$.style.marginTop="3.29rem"):$.style.marginTop="0.34rem"}}}function appendSpareSpinner(e){let t=document.createElement("div");t.classList.add("spare-spinner-container");let r=a.find(e=>"SpareLabel"===e["translation-key"])[CurrentLanguageCode];t.innerHTML=`
    <div class="spare-field">
      <label for="SpareQuantity" class="spare-header" data-translation-key="SpareLabel">${r}</label>
      <input type="number" inputmode="numeric" id="SpareQuantity" class="spare-text" name="SpareQuantity" min="0" max="100" value="0"size="3">
    </div>
  `,e.appendChild(t)}function appendTradeButtons(e){let t=document.createElement("div");t.classList.add("trade-button-container"),t.classList.add("BtnGroup2"),t.innerHTML=`
    <button class="lfft-btn lf-btn" type="button" data-property="lookingfor" tabindex="-1">LF</button><button class="lfft-btn ft-btn" type="button" data-property="fortrade" tabindex="-1">FT</button>
  `,e.appendChild(t);let r=t.querySelectorAll(".lfft-btn");r.forEach(e=>{e.addEventListener("mousedown",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("mouseup",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("mouseleave",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("touchstart",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("touchend",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("click",e=>{let t=e.target.closest(".lfft-btn"),r=t.closest(".sticker-card-container").getAttribute("data-global"),n=t.getAttribute("data-property");t&&updateLFOrFTValue(r,n)})})}function updateLFOrFTValue(e,t){let r=document.querySelector(`[data-global="${e}"] .trade-button-container .lfft-btn[data-property="${t}"]`);r&&(userData[e][t]=(userData[e][t]+1)%2,1===userData[e][t]?("lookingfor"===t&&r.classList.add("btnRed"),"fortrade"===t&&r.classList.add("btnGreen")):("lookingfor"===t&&r.classList.remove("btnRed"),"fortrade"===t&&r.classList.remove("btnGreen")))}function PerformSort(e){let t=e.currentTarget,r=t.dataset.sortType,n=Array.from(document.querySelectorAll("#current-sticker-board .sticker-card-container"));if(0!==n.length){if(n.sort((e,t)=>{let n=findStickerData(e.dataset.global),a=findStickerData(t.dataset.global);"StickerName"===r&&(r=`StickerName${CurrentLanguageCode}`);let o=n[r],l=a[r];if(!isNaN(o)&&!isNaN(l)){let s=parseFloat(o),c=parseFloat(l);return s===c?compareStickerNames(n,a):s-c}return o===l?compareStickerNames(n,a):o.localeCompare(l)}),"selected"===t.dataset.sortOnsite){let{selectedContainers:a,notSelectedContainers:o}=PerformSortOnsite(t),l=n[0].parentElement;a.forEach(e=>l.appendChild(e)),o.forEach(e=>l.appendChild(e))}else if("spare"===t.dataset.sortOnsite){let{sortSpareContainers:s}=PerformSortOnsite(t),c=n[0].parentElement;s.forEach(e=>c.appendChild(e))}else{let u=n[0].parentElement;n.forEach(e=>u.appendChild(e))}1===AscendZeroDescendOne&&Array.from(CurrentStickerBoardBlock.children).reverse().forEach(e=>{CurrentStickerBoardBlock.appendChild(e)}),SortBtnElementGroup.forEach(e=>e.classList.remove("btnBlue")),t.classList.add("btnBlue")}}function PerformSortOnsite(e){let t=document.querySelectorAll("#current-sticker-board .sticker-card-container"),r=e.dataset.sortOnsite;if("selected"===r){let n=Array.from(t).filter(e=>{let t=e.getAttribute("data-global");return 1===userData[t].selected}),a=Array.from(t).filter(e=>{let t=e.getAttribute("data-global");return 0===userData[t].selected});return{selectedContainers:n,notSelectedContainers:a}}if("spare"===r){let o=Array.from(t).sort((e,t)=>{let r=e.getAttribute("data-global"),n=t.getAttribute("data-global"),a=userData[r].spare,o=userData[n].spare;return a-o});return{sortSpareContainers:o,selectedContainers:[],notSelectedContainers:[]}}return{sortSpareContainers:[],selectedContainers:[],notSelectedContainers:[]}}function findStickerData(t){return e.find(e=>e.GlobalID===t)}function compareStickerNames(e,t){let r=e.GlobalID,n=t.GlobalID;return r.localeCompare(n)}function handleSortOrderBtnClick(){AscendZeroDescendOne=(AscendZeroDescendOne+1)%2,Array.from(CurrentStickerBoardBlock.children).reverse().forEach(e=>{CurrentStickerBoardBlock.appendChild(e)}),SortOrderBtnTextSpan.setAttribute("data-translation-key",`SortOrderBtnText_${AscendZeroDescendOne}`),translateLanguage(CurrentLanguageCode,`SortOrderBtnText_${AscendZeroDescendOne}`)}function FilterBySearchbar(r){let n=FilterMenuSearchBarComponent.getAttribute("data-filtervalue");if(""===FilterMenuSearchBarComponent.value){FilterList[n].FilterState=0,userData[r].show=1,updateClearFiltersButton();return}let a=FilterMenuSearchBarComponent.value.trim();a=(a=a.includes(",")?a.split(",").map(function(e){return e.trim()}):[a]).filter(function(e){return""!==e.trim()}),FilterList.hasOwnProperty(n)&&(FilterList[n].FilterValue=a,FilterList[n].FilterState=a.length>0?1:0);let o=e.find(function(e){return e.GlobalID===r}),l=o.SetID,s=t.find(function(e){return e.SetID===l}),c=s[`SetName${CurrentLanguageCode}`];if(o){let u=o[`StickerName${CurrentLanguageCode}`].toLowerCase().replace(/é/g,"e").replace(/ü/g,"u").replace(/'/g,"").replace(/！/g,"!"),d=c.toLowerCase().replace(/é/g,"e").replace(/ü/g,"u").replace(/'/g,"").replace(/！/g,"!"),p=a.map(function(e){return e.toLowerCase().replace(/é/g,"e").replace(/ü/g,"u").replace(/'/g,"").replace(/！/g,"!")});if(1===a.length)u.includes(p[0])||d.includes(p[0])||r.toString()===p[0]||o.SetID.toString()===p[0]?userData[r].show=1:userData[r].show=0;else if(a.length>1){if(0===AndZeroOrOne)p.every(function(e){return u.includes(e)||d.includes(e)||r.toString()===e||o.SetID.toString()===e})?userData[r].show=1:userData[r].show=0;else if(1===AndZeroOrOne){if(p.some(function(e){return u.includes(e)||d.includes(e)||r.toString()===e||o.SetID.toString()===e})){userData[r].show=1;return}userData[r].show=0}}}}function ChangeFilterButtonState(e,t){t&&(FilterList[e.dataset.filtervalue]={...FilterList[e.dataset.filtervalue],FilterState:(FilterList[e.dataset.filtervalue].FilterState+1)%3}),ChangeFilterBtnStyle(e)}function ChangeFilterBtnStyle(e){let t=FilterList[e.dataset.filtervalue].FilterState;0===t?e.classList.remove("btnRed","btnGreen"):1===t?(e.classList.add("btnGreen"),e.classList.remove("btnRed")):2===t&&(e.classList.add("btnRed"),e.classList.remove("btnGreen"))}function updateClearFiltersButton(){let e=0;Object.values(FilterList).forEach(t=>{0!==t.FilterState&&e++}),FilterLengthTextSpan.textContent=`(${e})`,ChangeClearFiltersButtonStyle()}function ChangeClearFiltersButtonStyle(){FilterLengthTextSpan.textContent>0?ClearFiltersBtnComponent.classList.add("btnRed"):ClearFiltersBtnComponent.classList.remove("btnRed")}function clearFilters(){FilterMenuSearchBarComponent.value="",Object.values(FilterList).forEach(e=>{if(0!==e.FilterState&&"1>StickerName>"!==e.FilterName){e.FilterState=0;let t=document.querySelector(`.filter-btn[data-filtervalue="${e.FilterName}"]`);ChangeFilterButtonState(t,!1)}}),PerformFilters(userData)}function PerformFilters(t){for(let r in t)t[r].show=1,0===AndZeroOrOne?(FilterBySpareRange(FilterList,r),1===t[r].show&&(FilterBySearchbar(r),1===t[r].show&&FilterByButtons(r))):1===AndZeroOrOne&&(FilterBySpareRange(FilterList,r),1===t[r].show&&(FilterByButtons(r),0===IncludeStateFilters.length&&0===ExcludeStateFilters.length&&(t[r].show=0,""===FilterMenuSearchBarComponent.value&&(t[r].show=1)),0===t[r].show&&""!==FilterMenuSearchBarComponent.value&&FilterBySearchbar(r)));""===FilterMenuSearchBarComponent.value&&(FilterList[FilterMenuSearchBarComponent.getAttribute("data-filtervalue")].FilterState=0),updateClearFiltersButton(),CurrentStickerBoardBlock.querySelector(".current-sticker-board-none")&&CurrentStickerBoardBlock.querySelector(".current-sticker-board-none").remove(),CurrentStickerBoardBlock.style.alignContent="",generateCurrentStickerBoard(e,t,"current-sticker-board");let n=Array.from(document.querySelectorAll("#current-sticker-board .sticker-card-container"));if(0===n.length){let o=a.find(e=>"NoMatchesFound"===e["translation-key"])[CurrentLanguageCode];CurrentStickerBoardBlock.innerHTML=`<span class="current-sticker-board-none" data-translation-key="NoMatchesFound">${o}</span>`,CurrentStickerBoardBlock.style.alignContent="center";return}{let l=document.querySelector(".sort-btn.btnBlue");l?PerformSort({currentTarget:l}):PerformSort({currentTarget:document.querySelector('button[data-sort-type="GlobalID"]')})}}window.onload=function(){compareViewport(),LoadingOverlayBlock.style.display="block",setTimeout(()=>{init(function(){LoadingOverlayBlock.style.display="none",LoadNews()})},0)},IgnorePrestigeBtnComponent.addEventListener("click",function(){1==(IgnorePrestige=(IgnorePrestige+1)%2)?IgnorePrestigeBtnComponent.classList.add("btnGreen"):IgnorePrestigeBtnComponent.classList.remove("btnGreen"),GenerateFilterSetButtons(),document.querySelector("#stickerset-filter .btn-subgroup").querySelectorAll(".filter-btn").forEach(e=>{ChangeFilterBtnStyle(e)}),UpdateTotalStickerQuantity(),UpdateTotalStickerByRarityQuantity();let t=document.querySelectorAll(".sticker-card-container");t.forEach(t=>{let r=e.find(e=>e.GlobalID===t.getAttribute("data-global"));"1"===r.Prestige&&(RestoreSelected(userData,t),RestoreStickerSpares(userData,t),RestoreTradeStates(userData,t),ChangeUserDataHaveSpareValue(userData,t))}),PerformFilters(userData),countSelectedStickers(),countVaultStickers()}),TradeButtonContainerBtnGroup.forEach(function(e){e.addEventListener("click",function(){let t=e.closest(".sticker-card-container").getAttribute("data-global"),r=e.getAttribute("data-property");updateLFOrFTValue(t,r)})}),StaticButtonsGroup.forEach(e=>{e.addEventListener("mousedown",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("mouseup",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("mouseleave",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("touchstart",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("touchend",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")})}),SortBtnElementGroup.forEach(e=>{e.addEventListener("click",e=>{PerformSort(e)})}),SortBtnElementGroup.forEach(e=>e.addEventListener("click",PerformSort)),SortOrderBtnComponent.addEventListener("click",handleSortOrderBtnClick),FilterMenuSearchBarComponent.addEventListener("input",()=>{PerformFilters(userData)}),document.addEventListener("click",function(e){"ClearFilterMenuSearchBar"===e.target.id&&(FilterMenuSearchBarComponent.value="",PerformFilters(userData))}),FilterBtnElementGroup.forEach(e=>{e.addEventListener("click",()=>{ChangeFilterButtonState(e,!0),PerformFilters(userData)})}),ClearFiltersBtnComponent.addEventListener("click",()=>{clearFilters()}),RefreshFiltersBtnComponent.addEventListener("click",function(){PerformFilters(userData)}),AndOrFilterModeBtnComponent.addEventListener("click",function(){AndZeroOrOne=(AndZeroOrOne+1)%2,AndOrFilterModeBtnTextSpan.setAttribute("data-translation-key",`AndOrFilterModeBtnText_${AndZeroOrOne}`),translateLanguage(CurrentLanguageCode,`AndOrFilterModeBtnText_${AndZeroOrOne}`),AndOrFilterModeBtnTooltipTextSpan.setAttribute("data-translation-key",`AndOrFilterModeBtnTooltipText_${AndZeroOrOne}`),translateLanguage(CurrentLanguageCode,`AndOrFilterModeBtnTooltipText_${AndZeroOrOne}`),PerformFilters(userData)});let DefaultStateFilters=[],IncludeStateFilters=[],ExcludeStateFilters=[];function FilterByButtons(r){let n=e.find(function(e){return e.GlobalID===r});for(let a in DefaultStateFilters.length=0,IncludeStateFilters.length=0,ExcludeStateFilters.length=0,FilterList){let o=FilterList[a];if("1>StickerName>"!==o.FilterName&&"0>spare>spare-filter-min|spare-filter-max"!==o.FilterName){if(o.FilterName.includes("SetID")){let l=o.FilterName.split(">")[2],s=t.find(e=>e.SetID===l);if(s&&1===IgnorePrestige&&"1"===s.Prestige)continue}switch(o.FilterState){case 0:DefaultStateFilters.push(o);break;case 1:IncludeStateFilters.push(o);break;case 2:ExcludeStateFilters.push(o)}}}if(0===IncludeStateFilters.length&&0===ExcludeStateFilters.length){userData[r].show=1;return}if(0===AndZeroOrOne){for(let c of IncludeStateFilters){let u=c.FilterKey;"0"===c.inDatabase?userData[r][u]!==parseInt(c.FilterValue)&&(userData[r].show=0):"1"===c.inDatabase&&n[u]!==c.FilterValue&&(userData[r].show=0)}for(let d of ExcludeStateFilters){let p=d.FilterKey;"0"===d.inDatabase?userData[r][p]===parseInt(d.FilterValue)&&(userData[r].show=0):"1"===d.inDatabase&&n[p]===d.FilterValue&&(userData[r].show=0)}}else if(1===AndZeroOrOne){if(IncludeStateFilters.length>0)for(let g of IncludeStateFilters){let m=g.FilterKey;if("0"===g.inDatabase){if(userData[r][m]===parseInt(g.FilterValue)){userData[r].show=1;return}userData[r].show=0}else if("1"===g.inDatabase){if(n[m]===g.FilterValue){userData[r].show=1;return}userData[r].show=0}}if(0===userData[r].show||ExcludeStateFilters.length>0)for(let f of ExcludeStateFilters){let S=f.FilterKey;if("0"===f.inDatabase){if(userData[r][S]!==parseInt(f.FilterValue)){userData[r].show=1;return}userData[r].show=0;return}if("1"===f.inDatabase){if(n[S]!==f.FilterValue){userData[r].show=1;return}userData[r].show=0;return}}}}function handleExpandBtnIconClick(){Array.from(ButtonGroupTitleElementGroup).forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget.querySelector(".ExpandBtnIcon"),r=t.getAttribute("src"),n="UpwardsArrow.png",a="DownwardsArrow.png",o=r.substring(r.lastIndexOf("/")+1);o===n?t.src=r.replace(n,a):o===a&&(t.src=r.replace(a,n))})})}document.addEventListener("DOMContentLoaded",()=>{handleExpandBtnIconClick()}),document.addEventListener("click",e=>{let t=e.target,r=t.closest(".sticker-card-container");r&&t.classList.contains("sticker-card")&&(r.classList.toggle("selected"),r.classList.toggle("not-selected"),UpdateCurrentAlbumStickerStates(r.getAttribute("data-global")),ApplySelectedStyle(r),ChangeUserDataHaveSpareValue(userData,r),countSelectedStickers(),countVaultStickers())}),ButtonGroupTitleElementGroup.forEach(e=>{e.addEventListener("click",()=>{let t=e.parentElement,r=t.querySelectorAll(".btn-subgroup");r.forEach(e=>{e.classList.toggle("hidden")})})});let stickerContainer=CurrentStickerBoardBlock;function handleFilterInput(e){let t=e.target;t.classList.contains("spare-filter-text")&&(t.value=t.value.replace(/^0+(?=\d)/,""),t.value>100?"100"===t.value.slice(0,-1)?t.value="100":t.value=t.value.slice(0,2):t.value<0?t.value=0:""===t.value&&setTimeout(()=>{""===t.value&&(t.value=0)},5e3))}function SwapSpareFilterMinMax(e){if(parseInt(SpareFilterMinInputComponent.value)>parseInt(SpareFilterMaxInputComponent.value)){let t=SpareFilterMaxInputComponent.value,r=SpareFilterMinInputComponent.value;SpareFilterMinInputComponent.value=t,SpareFilterMaxInputComponent.value=r}}function UpdateCurrentAlbumStickerStates(e){let t=document.querySelector(`.sticker-card-container[data-global="${e}"]`),r=t.classList.contains("not-selected")?0:1,n=parseInt(t.querySelector(".spare-text").value);userData[e]={...userData[e],selected:r,spare:n}}function FilterBySpareRange(e,t){let r=e["0>spare>spare-filter-min|spare-filter-max"];if(r&&0===r.FilterState){userData[t].show=1;return}let[n,a]=r.FilterValue,o=parseInt(document.getElementById(n).value,10),l=parseInt(document.getElementById(a).value,10),s=2===r.FilterState,c=parseInt(userData[t].spare,10);c>=o&&c<=l?userData[t].show=s?0:1:userData[t].show=s?1:0}function RestoreStickerSpares(e,t){let r=t.getAttribute("data-global"),n=e[r],a=n.spare;t.querySelector(".spare-text").value=a}function RestoreSelected(e,t){let r=t.getAttribute("data-global");t.classList.toggle("selected",1===e[r].selected),t.classList.toggle("not-selected",0===e[r].selected),ApplySelectedStyle(t)}function RestoreTradeStates(e,t){let r=t.getAttribute("data-global"),n=e[r];t.querySelector('.trade-button-container .lfft-btn[data-property="lookingfor"]').classList.remove("btnRed"),t.querySelector('.trade-button-container .lfft-btn[data-property="fortrade"]').classList.remove("btnGreen"),1===n.lookingfor&&t.querySelector('.trade-button-container .lfft-btn[data-property="lookingfor"]').classList.add("btnRed"),1===n.fortrade&&t.querySelector('.trade-button-container .lfft-btn[data-property="fortrade"]').classList.add("btnGreen")}function updateProgressBar(){let e=document.querySelectorAll(".progress-container");e.forEach(function(e){let t=e.querySelector(".progress-text").textContent;t=t.replace(/\s/g,"");let r=parseInt(t.split("/")[0]),n=parseInt(t.split("/")[1]),a=e.querySelector(".progress-bar");if(0===r)a.style.width="0";else{let o=r/n*100;a.style.width="100%",r<n?a.style.background=`linear-gradient(90deg, #34c7fb ${o}%, var(--progress-bar-black) ${o}%)`:(a.style.background="",a.style.backgroundColor="#37ad3f")}})}function GenerateFilterSetButtons(){let r=document.querySelector("#stickerset-filter .btn-subgroup");r.innerHTML=SetProgressTrackerBlock.innerHTML="",t.filter(e=>e.AlbumNo===CurrentAlbumNumber).forEach(t=>{let{SetID:n,Colour:o,AlbumNo:l}=t,s=parseInt(n)-100*parseInt(l),c=t[`SetName${CurrentLanguageCode}`],u=`Icon_${n}.png`,d=e.filter(e=>e.SetID===n).length,p=t.Prestige,g=r.querySelector(`[data-filtervalue="1>SetID>${n}"]`),m=SetProgressTrackerBlock.querySelector(`[data-setidnumber="${n}"]`),f=a.find(e=>"set"===e["translation-key"])[CurrentLanguageCode];if(1===IgnorePrestige&&"1"===p)g&&g.remove(),m&&m.remove();else{if(!g){let S=`
          <button data-filtervalue="1>SetID>${n}" class="filter-btn btn" type="button"><span data-translation-key="set">${f}</span>&nbsp;${s}</button>
        `;r.innerHTML+=S}if(!m){let y="set-name";c.length>15&&(y="set-name-long-min15"),isBrighterThan(o,"#CCCCCC")&&(y+="-dark");let b=`
            <div class="set-card-container"><img draggable="false" data-setidnumber="${n}" class="set-logo" src="logo/${u}"><div class="${y}" style="background-color: ${o};"><span><span data-translation-key="set">${f}</span> ${s}</span><span class="SetNameText" data-setid="${n}"></span></div><div class="progress-container"><div class="progress-bar"></div><div class="progress-text"><span data-setid="${n}">0</span> / ${d}</div></div></div>
          `;SetProgressTrackerBlock.innerHTML+=b}}}),translateLanguage(CurrentLanguageCode,"set"),TranslateSetName(CurrentLanguageCode);let n=r.querySelectorAll(".filter-btn");n.forEach(e=>{e.addEventListener("mousedown",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("mouseup",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("mouseleave",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("touchstart",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("touchend",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("click",e=>{let t=e.target.closest(".filter-btn");t&&(ChangeFilterButtonState(t,!0),PerformFilters(userData))})})}function exportUserData(e){Object.keys(userData).forEach(e=>{userData[e].spare=parseInt(userData[e].spare),userData[e]={...defaultValues,...userData[e]}});let t=PlayerIGNInputComponent.value,r=PlayerLinkInputComponent.value,n=LeftoverVaultStarsInputComponent.value,a=(IgnorePrestige+1)%2,o=[`CurrentAlbumNumber: ${CurrentAlbumNumber}`,`IsPrestige: ${a}`,`player-ign: ${t}`,`player-link: ${r}`,`leftover-vault-stars: ${n}`,],l=JSON.stringify(userData,null,2),s=o.join("\n")+"\n"+l;ProfileTextAreaComponent.value=s,e&&(localStorage.setItem("userData",s),SaveToProfileList())}function importUserData(t){if(""===t){console.error("Textarea value is empty.");return}let n;try{let a="",o="",l="",s="",c=1,u=t.split("\n");u.forEach((t,n)=>{if(t.startsWith("CurrentAlbumNumber: ")){if((s=t.substring(20))!==CurrentAlbumNumber){if(r.find(e=>e.AlbumNo===s))document.querySelector(`button[data-album-number = "${s}"]`).click();else throw console.error("Incorrect Album:",s,", new userData for the current album will be created."),CreateNewUserData(e),Error("Incorrect Album")}}else t.startsWith("IsPrestige: ")?c=parseInt(t.substring(12)):t.startsWith("player-ign: ")?a=t.substring(12):t.startsWith("player-link: ")?o=t.substring(13):t.startsWith("leftover-valve-stars: ")?u[n]=t.replace("leftover-valve-stars: ","leftover-vault-stars: "):t.startsWith("leftover-vault-stars: ")&&(l=t.substring(22))}),""===l&&(l="0");let d=u.filter(e=>!e.startsWith("CurrentAlbumNumber: ")&&!e.startsWith("player-ign: ")&&!e.startsWith("player-link: ")&&!e.startsWith("leftover-vault-stars: ")&&!e.startsWith("IsPrestige: ")),p=d.join("\n");n=JSON.parse(p),Object.keys(n).forEach(t=>{let{id:r,...a}=n[t];parseInt(e.find(e=>e.GlobalID===r).AlbumNo)!==parseInt(CurrentAlbumNumber)?delete n[t]:n[t]={id:r,...Object.fromEntries(Object.entries(a).map(([e,t])=>[e,parseInt(t)]))}}),PlayerIGNInputComponent.value=a,PlayerLinkInputComponent.value=o,LeftoverVaultStarsInputComponent.value=l,userData=n,clearFilters();let g=document.querySelectorAll(".sticker-card-container");g.forEach(e=>{if(userData[e.getAttribute("data-global")])RestoreSelected(userData,e),RestoreStickerSpares(userData,e),RestoreTradeStates(userData,e),ChangeUserDataHaveSpareValue(userData,e);else{let t={...defaultValues,id:e.getAttribute("data-global")};userData[e.getAttribute("data-global")]=t}}),c===IgnorePrestige&&IgnorePrestigeBtnComponent.click(),countVaultStickers(),countSelectedStickers()}catch(m){console.error("Invalid JSON format:",m);return}"object"!=typeof userData||Array.isArray(userData)?(console.error("Invalid userData format. Expected an object."),CreateNewUserData()):console.log("Successfully imported userData:",userData)}function UpdateTotalStickerQuantity(){let t=0;e.filter(e=>e.AlbumNo===CurrentAlbumNumber).forEach(e=>{(1!==IgnorePrestige||"1"!==e.Prestige)&&t++}),TotalStickersQuantityTextSpan.textContent=t.toString()}function UpdateTotalStickerByRarityQuantity(){for(let t=1;t<=5;t++){let r=document.getElementById(`total-rarity${t}-quantity`),n=0;e.filter(e=>e.AlbumNo===CurrentAlbumNumber&&parseInt(e.StickerRarity)===t).forEach(e=>{(1!==IgnorePrestige||"1"!==e.Prestige)&&n++}),r.textContent=n.toString()}let a=0;e.forEach(e=>{(1!==IgnorePrestige||"1"!==e.Prestige)&&1===parseInt(e.Golden)&&e.AlbumNo===CurrentAlbumNumber&&a++}),TotalGoldQuantityTextSpan.textContent=a.toString()}function countSelectedStickers(){let t=new Map,r=Array.from(document.querySelectorAll(".progress-text span[data-setid]"));for(let n in r.forEach(e=>{e.textContent="0"}),userData){let a=userData[n].id,o=e.find(e=>e.GlobalID===a);if((1!==IgnorePrestige||"1"!==o.Prestige)&&userData.hasOwnProperty(n)&&1===userData[n].selected){let l=Math.floor(userData[n].id/100);t.has(l)?t.set(l,t.get(l)+1):t.set(l,1)}}let s=0;for(let[c,u]of t){let d=r.find(e=>e.getAttribute("data-setid")===c.toString());d&&(d.textContent=(parseInt(d.textContent,10)+u).toString()),s+=u}UserStickersQuantityTextSpan.textContent=s.toString(),countSelectedStickerByRarity(),updateProgressBar()}function countSelectedStickerByRarity(){for(let t=1;t<=5;t++)document.getElementById(`rarity${t}-quantity`).textContent=0,document.getElementById(`rarity${t}-percentage`).textContent=0;for(let r in GoldQuantityTextSpan.textContent=0,GoldPercentageTextSpan.textContent=0,userData){let n=userData[r].id,a=e.find(e=>e.GlobalID===n);if((1!==IgnorePrestige||"1"!==a.Prestige)&&userData.hasOwnProperty(r)&&1===userData[r].selected){let o=a.StickerRarity;document.getElementById(`rarity${o}-quantity`).textContent++,"1"===a.Golden&&GoldQuantityTextSpan.textContent++}}for(let l=1;l<=5;l++){let s=parseInt(document.getElementById(`rarity${l}-quantity`).textContent),c=parseInt(document.getElementById(`total-rarity${l}-quantity`).textContent),u=(s/c*100).toFixed(1);document.getElementById(`rarity${l}-percentage`).textContent=`${u}%`}let d=(parseInt(GoldQuantityTextSpan.textContent)/parseInt(TotalGoldQuantityTextSpan.textContent)*100).toFixed(1);GoldPercentageTextSpan.textContent=`${d}%`}function countVaultStickers(){let t=0;for(let r in userData){let n=userData[r].id,a=e.find(e=>e.GlobalID===n);if((1!==IgnorePrestige||"1"!==a.Prestige)&&userData.hasOwnProperty(r)&&userData[r].spare>0&&1===userData[r].selected){let o=e.find(e=>e.GlobalID===n);if(o){let l=userData[r].spare,s=parseInt(o.StickerRarity),c=parseInt(o.Golden);1===c?t+=l*s*2:t+=l*s}}}let u=LeftoverVaultStarsInputComponent.value;isNaN(u)&&(u=0);let d=t+parseInt(u);TotalVaultQuantityTextSpan.textContent=d.toString();let p=0,g="";NextVaultCounterTextSpan.style.display="block",d<250?(p=250-d,g="NextVaultCounterText_0",vaultTierImage.src=""):250<=d&&d<500?(p=500-d,g="NextVaultCounterText_1",vaultTierImage.src="assets/stickers/StickerVaultTier1.png"):500<=d&&d<700?(p=700-d,g="NextVaultCounterText_2",vaultTierImage.src="assets/stickers/StickerVaultTier2.png"):d>=700&&(p=d-700,vaultTierImage.src="assets/stickers/StickerVaultTier3.png",g="NextVaultCounterText_3"),NextVaultCounterTextSpan.setAttribute("data-translation-key",g),translateLanguage(CurrentLanguageCode,g);let m=NextVaultCounterTextSpan.textContent;if(m=m.replace("${StickersToNextTier}",p),d>=700){let f=Math.floor(d/700);(m=m.replace("${TierThreeVaultExchangeAmount}",f)).includes("${times}")&&(m=m.replace("${times}",0===f||f>1?"times":"time"))}NextVaultCounterTextSpan.textContent=m}function ChangeUserDataHaveSpareValue(e,t){let r=t.getAttribute("data-global");1===e[r].selected&&e[r].spare>0?e[r].havespare=1:e[r].havespare=0}function UpdateAlbumStartEndTime(){let e=r.find(e=>e.AlbumNo===CurrentAlbumNumber);AlbumIconContainerBlock.innerHTML=`<img draggable="false" class="album-logo" src="logo/album_${CurrentAlbumNumber}.png" alt="${e.ImageSource}"</img>`;let t=new Date(1e3*e.StartTime),n=new Date(1e3*e.EndTime),a=t.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),o=n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return StartTimeTextSpan.textContent=a,EndTimeTextSpan.textContent=o,n}function updateTimeLeft(e){let t=new Date,r=e.getTime()-t.getTime();if(r<=0){let n=a.find(e=>"AlbumEndedText"===e["translation-key"])[CurrentLanguageCode];TimeLeftTextSpan.textContent=n,TimeLeftTextSpan.style.color=""}else{let o=Math.floor(r/864e5),l=Math.floor(r%864e5/36e5),s=Math.floor(r%36e5/6e4),c="";o>0&&(c+=`${o}d `),l>0&&(c+=`${l}h `),s>0&&(c+=`${s}m `),c+=`${Math.floor(r%6e4/1e3)}s`,TimeLeftTextSpan.textContent=c.trim(),r<=864e5?TimeLeftTextSpan.style.color="red":TimeLeftTextSpan.style.color=""}}stickerContainer.addEventListener("input",function(e){let t=e.target,r=t.closest(".sticker-card-container");if(t.classList.contains("spare-text")&&r){t.value=t.value.replace(/^0+(?=\d)/,"");let n=r.getAttribute("data-global");t.value>100?"100"===t.value.slice(0,-1)?t.value="100":t.value=t.value.slice(0,2):t.value<0?t.value=0:""===t.value&&setTimeout(()=>{""===t.value&&(t.value=0)},5e3),t.value>0&&!r.classList.contains("selected")&&(r.classList.add("selected"),r.classList.remove("not-selected"),userData[n].selected=1),countSelectedStickers(),UpdateCurrentAlbumStickerStates(n),ChangeUserDataHaveSpareValue(userData,r),ApplySelectedStyle(r),countVaultStickers()}}),SpareFilterMinInputComponent.addEventListener("input",handleFilterInput),SpareFilterMaxInputComponent.addEventListener("input",handleFilterInput),SpareFilterBtnComponent.addEventListener("click",()=>{SwapSpareFilterMinMax(),PerformFilters(userData)}),ImportBtnComponent.addEventListener("click",()=>{let e=ImportBtnComponent.querySelector("#import-btn-text"),t=ProfileTextAreaComponent.value.trim();importUserData(t),setTimeout(function(){let t=a.find(e=>"ImportSuccessful"===e["translation-key"])[CurrentLanguageCode];e.textContent=t,setTimeout(function(){e.textContent=a.find(e=>"import"===e["translation-key"])[CurrentLanguageCode]},3e3)},0)}),ImportFromFileBtnComponent.addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.accept=".txt",e.addEventListener("change",()=>{let t=e.files[0],r=new FileReader;r.onload=function(e){let t=e.target.result.trim();ProfileTextAreaComponent.value=t,importUserData(t)},r.readAsText(t);let n=ImportFromFileBtnComponent.querySelector("#import-from-file-btn-text");setTimeout(function(){let e=a.find(e=>"ImportSuccessful"===e["translation-key"])[CurrentLanguageCode];n.textContent=e,setTimeout(function(){n.textContent=a.find(e=>"LoadFromText"===e["translation-key"])[CurrentLanguageCode]},3e3)},0)}),e.click()}),ExportBtnComponent.addEventListener("click",()=>{exportUserData(!0);let e=ExportBtnComponent.querySelector("#export-btn-text");setTimeout(function(){let t=a.find(e=>"Saved"===e["translation-key"])[CurrentLanguageCode];e.textContent=t,setTimeout(function(){e.textContent=a.find(e=>"save"===e["translation-key"])[CurrentLanguageCode]},3e3)},0)}),ExportFromFileBtnComponent.addEventListener("click",()=>{exportUserData(!1);let e=new Blob([ProfileTextAreaComponent.value],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a"),o=new Date,l=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),u=String(o.getHours()).padStart(2,"0"),d=String(o.getMinutes()).padStart(2,"0"),p=String(o.getSeconds()).padStart(2,"0"),g=r.find(e=>e.AlbumNo===CurrentAlbumNumber),m=g[`AlbumName${CurrentLanguageCode}`].replace(/\s/g,"");n.download=`mogotools-userData_${m}_${l}${s}${c}_${u}${d}${p}.txt`,n.href=t,n.click();let f=ExportFromFileBtnComponent.querySelector("#export-from-file-btn-text");setTimeout(function(){let e=a.find(e=>"SaveAsTxtSuccessful"===e["translation-key"])[CurrentLanguageCode];f.textContent=e,setTimeout(function(){f.textContent=a.find(e=>"SaveAsText"===e["translation-key"])[CurrentLanguageCode]},3e3)},0)});let endDateTime=UpdateAlbumStartEndTime();function isBrighterThan(e,t){let r=calculateBrightness(e),n=calculateBrightness(t);return r>n}function calculateBrightness(e){let t=e.slice(1),r=parseInt(t,16);return(299*(r>>16&255)+587*(r>>8&255)+114*(255&r))/1e3}function DarkenColour(e,t){let r=(e=>{let t=parseInt(e.substring(1),16);return[t>>16&255,t>>8&255,255&t]})(e),n=((e,t)=>{let[r,n,a]=e;return[Math.floor(r*t),Math.floor(n*t),Math.floor(a*t)]})(r,1-t/100),a=(e=>{let[t,r,n]=e,a=e=>{let t=e.toString(16);return 1===t.length?0+t:t};return`#${a(t)}${a(r)}${a(n)}`})(n);return a}function handleSetImageOrientationBtnClick(e){!0===e&&(ImgOrientationLandscapeZeroPortraitOne=(ImgOrientationLandscapeZeroPortraitOne+1)%2),SetImageOrientationBtnComponent.setAttribute("data-translation-key",`SetImageOrientationBtnText_${ImgOrientationLandscapeZeroPortraitOne}`),translateLanguage(CurrentLanguageCode,`SetImageOrientationBtnText_${ImgOrientationLandscapeZeroPortraitOne}`)}updateTimeLeft(endDateTime),setInterval(()=>updateTimeLeft(endDateTime),1e3),SetImageOrientationBtnComponent.addEventListener("click",function(){handleSetImageOrientationBtnClick(!0)});let includeIGN=0,includePlayerLink=0;function copyToCollectionScreenshot(t){let r=document.getElementById(t);if(MiddleSideBlock&&r){r.innerHTML="";let n=MiddleSideBlock.innerHTML;r.style.backgroundColor="rgba(248, 244, 228)",r.setAttribute("style",MiddleSideBlock.getAttribute("style")),r.style.background='url("assets/background/Collections_Album_BG.png")',n=(n=n.replace(/sticker-card-container/g,"sticker-card-container-screenshot")).replace(/trade-button-container/g,"trade-button-container-screenshot"),r.innerHTML=n;let a=r.querySelectorAll(".sticker-card-container-screenshot");a.forEach(function(t){let n=t.getAttribute("data-global"),a=document.createElement("span");a.className="spare-text-screenshot",a.textContent=userData[n].spare;let o=t.querySelector(".spare-text");o&&o.parentNode.replaceChild(a,o);let l=t.querySelector(".spare-spinner-container");if(l&&l.parentNode.removeChild(l),userData[n].spare>0){let s=e.find(e=>e.GlobalID===n),c="Collections_TradingGroup_NumberBG_Small.png";"1"===s.Golden&&(c="GoldenBlitz_Stickers_Badge01.png");let u=document.createElement("div");if(u.className="spare-container-no-spinner",u.innerHTML=`
          <img draggable="false" class="spare-img" src="assets/stickers/${c}">
          <span class="spare-snapshot-text">+${userData[n].spare}</span>
        `,"1"===s.Golden&&(u.querySelector(".spare-img").style.width="50%",u.style.marginTop="-63px",u.querySelector(".spare-snapshot-text").style.color="white",u.querySelector(".spare-snapshot-text").style.marginTop="4.5px"),t.querySelector(".sticker-ribbon")){let d=t.querySelector(".sticker-ribbon").parentNode;d.insertBefore(u,t.querySelector(".sticker-ribbon")),t.querySelector(".sticker-ribbon").style.marginTop="-4.5px","1"===s.Golden&&(t.querySelector(".sticker-ribbon").style.marginTop="-8.5px")}if(t.querySelector(".sticker-ribbon-transparent")){let p=t.querySelector(".sticker-ribbon-transparent").parentNode;p.insertBefore(u,t.querySelector(".sticker-ribbon-transparent")),t.querySelector(".sticker-ribbon-transparent").style.marginTop="-58.5px"}if(1===ImgOrientationLandscapeZeroPortraitOne&&("0"===s.Golden?(t.querySelector(".spare-snapshot-text").style.marginLeft="-31px",t.querySelector(".spare-snapshot-text").style.marginTop="3px"):t.querySelector(".spare-snapshot-text").style.marginLeft="-33px"),navigator.userAgent.indexOf("Safari")>-1){let g=t.querySelector(".spare-snapshot-text");g.style.marginTop=parseInt(g.style.marginTop)+1+"px";let m="";t.querySelector(".sticker-ribbon")&&(m=t.querySelector(".sticker-ribbon")),t.querySelector(".sticker-ribbon-transparent")&&(m=t.querySelector(".sticker-ribbon-transparent")),m.style.marginTop=parseInt(m.style.marginTop)+1+"px"}}let f=!0,S=r.querySelectorAll(".trade-button-container-screenshot");if(S.forEach(function(e){let t=e.querySelectorAll(".lf-btn");t.forEach(function(e){e.classList.contains("btnRed")||(f=!1)})}),f){let y=r.querySelectorAll(".sticker-card-container-screenshot");y.forEach(function(e){e.style.opacity="1.0"})}t.querySelector(".sticker-ribbon-transparent")?t.querySelector(".trade-button-container-screenshot").style.marginTop="54px":t.querySelector(".trade-button-container-screenshot").style.marginTop="6px",t.querySelector(".trade-button-container-screenshot").style.width="100%",t.querySelector(".trade-button-container-screenshot").style.display="flex",1===ImgOrientationLandscapeZeroPortraitOne&&(t.style.flexBasis="calc(28% - 10px)")})}else console.log("Either middle-side or collection-screenshot element is not found.")}function copyToTradeScreenshot(t,r){let n=document.getElementById(t);if(n.style.alignContent="",CurrentStickerBoardBlock&&n){n.innerHTML="",n.style.backgroundColor="rgba(248, 244, 228)";let o=document.createDocumentFragment(),l=e.filter(e=>e.GlobalID in userData&&1===userData[e.GlobalID][r]&&1===userData[e.GlobalID].show).sort((e,t)=>e.Golden>t.Golden?-1:e.Golden<t.Golden?1:e.StickerRarity>t.StickerRarity?-1:e.StickerRarity<t.StickerRarity?1:e.GlobalID<t.GlobalID?-1:e.GlobalID>t.GlobalID?1:0);if(0===l.length){let s=a.find(e=>"None"===e["translation-key"])[CurrentLanguageCode];n.innerHTML=`<span class="lfft-snapshot-none" data-translation-key="none">${s}</span>`,n.style.alignContent="center";return}{for(let c of l){let u=userData[c.GlobalID],d=u.id,p=e.find(e=>e.GlobalID===d);if(1!==IgnorePrestige||"1"!==p.Prestige){if(0!==u[r]){{let g=CreateStickerElement(c,"sticker-card-container","sticker-card",!0);o.appendChild(g)}n.appendChild(o)}}}n.innerHTML=n.innerHTML.replace(/sticker-card-container/g,"sticker-card-container-screenshot");let m=n.querySelectorAll(".sticker-card-container-screenshot");m.forEach(function(t){let n=t.getAttribute("data-global"),a=document.createElement("span");a.className="spare-text-screenshot",a.textContent=userData[n].spare;let o=t.querySelector(".spare-text");if(0===userData[n][r])t.remove();else{t.style.opacity="1.0",t.querySelector(".trade-button-container").remove(),o&&o.parentNode.replaceChild(a,o);let l=t.querySelector(".spare-spinner-container");if(l&&l.parentNode.removeChild(l),userData[n].spare>0){let s=e.find(e=>e.GlobalID===n),c="Collections_TradingGroup_NumberBG_Small.png";"1"===s.Golden&&(c="GoldenBlitz_Stickers_Badge01.png");let u=document.createElement("div");if(u.className="spare-container-no-spinner",u.innerHTML=`
              <img draggable="false" class="spare-img" src="assets/stickers/${c}">
              <span class="spare-snapshot-text">+${userData[n].spare}</span>
            `,"1"===s.Golden&&(u.querySelector(".spare-img").style.width="50%",u.style.marginTop="-63px",u.querySelector(".spare-snapshot-text").style.color="white",u.querySelector(".spare-snapshot-text").style.marginTop="4.5px"),t.querySelector(".sticker-ribbon")){let d=t.querySelector(".sticker-ribbon").parentNode;d.insertBefore(u,t.querySelector(".sticker-ribbon")),t.querySelector(".sticker-ribbon").style.marginTop="-4.5px","1"===s.Golden&&(t.querySelector(".sticker-ribbon").style.marginTop="-8.5px")}if(t.querySelector(".sticker-ribbon-transparent")){let p=t.querySelector(".sticker-ribbon-transparent").parentNode;p.insertBefore(u,t.querySelector(".sticker-ribbon-transparent")),t.querySelector(".sticker-ribbon-transparent").style.marginTop="-58.5px"}if(1===ImgOrientationLandscapeZeroPortraitOne&&("0"===s.Golden?(t.querySelector(".spare-snapshot-text").style.marginLeft="-31px",t.querySelector(".spare-snapshot-text").style.marginTop="3px"):t.querySelector(".spare-snapshot-text").style.marginLeft="-33px"),navigator.userAgent.indexOf("Safari")>-1){let g=t.querySelector(".spare-snapshot-text");g.style.marginTop=parseInt(g.style.marginTop)+1+"px",t.querySelector(".sticker-ribbon")&&t.querySelector(".sticker-ribbon"),t.querySelector(".sticker-ribbon-transparent")&&t.querySelector(".sticker-ribbon-transparent"),stickerRibbon.style.marginTop=parseInt(stickerRibbon.style.marginTop)+1+"px"}}1===ImgOrientationLandscapeZeroPortraitOne&&(t.style.flexBasis="calc(28% - 10px)")}}),1===ImgOrientationLandscapeZeroPortraitOne&&(n.style.width="440px")}}else console.log("Either middle-side or collection-screenshot element is not found.")}function ResizeElementBeforeCapture(e){let t,r,n,a;(n=(t=e.offsetWidth)*(r=e.offsetHeight))>1579008&&(a=Math.sqrt(1579008/n),e.style.transform=`scale(${a})`,e.style.transformOrigin="top left")}function captureScreenshot(e){let t=document.getElementById(e);t?html2canvas(t,{scale:2,useCORS:!0}).then(function(e){let t=new Date,n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),c=String(t.getSeconds()).padStart(2,"0"),u=r.find(e=>e.AlbumNo===CurrentAlbumNumber),d=u[`AlbumName${CurrentLanguageCode}`].replace(/\s/g,"");if(navigator.userAgent.indexOf("Safari")>-1)e.toBlob(function(e){let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=`mogotools-screenshot_${d}_${n}${a}${o}_${l}${s}${c}.png`,t.click()});else{let p=e.toDataURL("image/png"),g=document.createElement("a");g.href=p,g.download=`mogotools-screenshot_${d}_${n}${a}${o}_${l}${s}${c}.png`,g.click()}}).catch(function(e){console.error("Error:",e)}):console.log("collection-screenshot element is not found.")}function handleViewportBtnClick(e){!0===e&&(WebZeroMobileOne=(WebZeroMobileOne+1)%2),0===WebZeroMobileOne?(DefaultCSSSheet.removeAttribute("disabled"),MobileCSSSheet.setAttribute("disabled",!0),ProgressMenuModal.style.display="initial",FilterSortModal.style.display="initial"):1===WebZeroMobileOne&&(DefaultCSSSheet.setAttribute("disabled",!0),MobileCSSSheet.removeAttribute("disabled"),FilterSortModal.style.display="none",ProgressMenuModal.style.display="none"),ViewportBtnTextSpan.setAttribute("data-translation-key",`ViewportBtnText_${WebZeroMobileOne}`),translateLanguage(CurrentLanguageCode,`ViewportBtnText_${WebZeroMobileOne}`)}function compareViewport(){let e=window.innerWidth,t=window.innerHeight;e>t?(WebZeroMobileOne=0,ImgOrientationLandscapeZeroPortraitOne=0):(WebZeroMobileOne=1,ImgOrientationLandscapeZeroPortraitOne=1),handleViewportBtnClick(!1),handleSetImageOrientationBtnClick(!1)}function handleLayoutThemeBtnClick(e){!0===e&&(LightZeroDarkOne=(LightZeroDarkOne+1)%2),0===LightZeroDarkOne?LayoutBtnTextSpan.textContent="Dark Mode":1===LightZeroDarkOne&&(LayoutBtnTextSpan.textContent="Light Mode")}function generateCurrentFiltersModalText(){CurrentFiltersContentBlock.innerHTML="";let e=[],t=[];for(let r of Object.values(FilterList)){let n=r.FilterName,a=r.FilterState,o=r.FilterValue;if(1===a){if("1>StickerName>"===n)Array.isArray(o)&&e.push(...o.map(e=>`<span data-translation-key="IS"></span> "${e}"`));else if("0>spare>spare-filter-min|spare-filter-max"!==n){let l=document.querySelector(`button[data-filtervalue="${n}"]`);l&&e.push(`<span data-translation-key="IS"></span> ${l.innerHTML}`)}}else if(2===a){if("1>StickerName>"===n)Array.isArray(o)&&t.push(...o.map(e=>`<span data-translation-key="NOT"></span> "${e}"`));else if("0>spare>spare-filter-min|spare-filter-max"!==n){let s=document.querySelector(`button[data-filtervalue="${n}"]`);s&&t.push(`<span data-translation-key="NOT"></span> ${s.innerHTML}`)}}}let c=FilterList["0>spare>spare-filter-min|spare-filter-max"].FilterState,u=e.length>0?`<b><span data-translation-key="IncludeFilters"></span></b><br><ul>
${e.map(e=>`<li>${e}</li>`).join("\n")}
</ul>`:"",d=t.length>0?`<b><span data-translation-key="ExcludeFilters"></span></b><br><ul>
${t.map(e=>`<li>${e}</li>`).join("\n")}
</ul>`:"",p=Object.keys(userData).filter(e=>1===userData[e].show).length;CurrentFiltersContentBlock.innerHTML=`<span data-translation-key="ViewCurrentFiltersBtn_CurrentFilterModeText_${AndZeroOrOne}"></span><br><br><span data-translation-key="ViewCurrentFiltersBtn_FoundText"></span>&nbsp;${p}&nbsp;<span data-translation-key="ViewCurrentFiltersBtn_StickerText"></span><br><br><span data-translation-key="ViewCurrentFiltersBtn_CurrentFilterDescription_FilterMode${AndZeroOrOne}_SpareFilter${c}"></span><br><br>${u}<br>${d}`;let g=CurrentFiltersContentBlock.querySelectorAll("[data-translation-key]");g.forEach(e=>{let t=e.dataset.translationKey;translateLanguage(CurrentLanguageCode,t)}),CurrentFiltersContentBlock.innerHTML.includes("${spareMinValue}")&&CurrentFiltersContentBlock.innerHTML.includes("${spareMaxValue}")&&(CurrentFiltersContentBlock.innerHTML=CurrentFiltersContentBlock.innerHTML.replace("${spareMinValue}",SpareFilterMinInputComponent.value).replace("${spareMaxValue}",SpareFilterMaxInputComponent.value))}function GenerateTradePostClipboard(){TradePostTextAreaComponent.value="";let t=[],r=[],n=new Set,o=new Set,l=(t,r,n,a)=>{let o=t.id,l=e.find(e=>e.GlobalID===o),s=t.spare;if(l){let{SetID:c,AlbumNo:u,GlobalID:d,StickerRarity:p,Golden:g}=l,m=l[`StickerName${CurrentLanguageCode}`],f=s>0?`(x${s})`:"",S=`- ${m}, Set ${c-100*u}, ${p}★${"1"===g?a:""} ${f}
`;r.push(S),n.add(p)}};for(let s in userData)1===userData[s].lookingfor&&1===userData[s].show&&l(userData[s],t,n,"(G)"),1===userData[s].fortrade&&1===userData[s].show&&l(userData[s],r,o,"(G)");let c=(e,t)=>{e.sort((e,r)=>{let n=e.includes(t),a=r.includes(t);if(n!==a)return a-n;let o=Number(e.split("★")[0].split(",")[2]),l=Number(r.split("★")[0].split(",")[2]);if(o!==l)return l-o;let s=Number(e.split("Set ")[1].split(" #")[0]),c=Number(r.split("Set ")[1].split(" #")[0]);return s-c})};c(t,"(G)"),c(r,"(G)");let u=a.find(e=>"LookingFor_TradePost"===e["translation-key"])[CurrentLanguageCode],d=a.find(e=>"ForTrade_TradePost"===e["translation-key"])[CurrentLanguageCode],p=a.find(e=>"TradePostMessage"===e["translation-key"])[CurrentLanguageCode],g="";if(1===n.size&&1===o.size&&[...n][0]===[...o][0]){let m=[...n][0];g+=`${m}★

`,t=t.map(e=>e.replace(`, ${m}★`," ")),r=r.map(e=>e.replace(`, ${m}★`," "))}g+=`${u}
${t.join("")}
${d}
${r.join("")}
${p}`,TradePostTextAreaComponent.value=g}function copyTradePostAreaToClipboard(){let e=TradePostTextAreaComponent.value;navigator.clipboard.writeText(e).then(()=>{CopyTradePostAreaBtnComponent.classList.add("btnYellowTransition");let e=a.find(e=>"copied"===e["translation-key"])[CurrentLanguageCode];CopyTradePostAreaBtnTextSpan.textContent=e,setTimeout(()=>{CopyTradePostAreaBtnComponent.classList.remove("btnYellowTransition");let e=a.find(e=>"copy"===e["translation-key"])[CurrentLanguageCode];CopyTradePostAreaBtnTextSpan.textContent=e},3e3)}).catch(e=>{console.error("Failed to copy text: ",e)})}function handleVaultPrestigeInput(e){let t=e.target;if(t.classList.contains("vault-prestige-text")){if(t.value=t.value.replace(/^0+(?=\d)/,""),t.value>9999)"9999"===t.value.slice(0,-1)?t.value="9999":t.value=t.value.slice(0,4);else if(t.value<0)t.value=0;else if(""===t.value){setTimeout(()=>{""===t.value&&(t.value=0,countVaultStickers())},5e3);return}}countVaultStickers()}IncludePlayerIGNBtnComponent.addEventListener("click",function(){1==(includeIGN=(includeIGN+1)%2)?IncludePlayerIGNBtnComponent.classList.add("btnGreen"):IncludePlayerIGNBtnComponent.classList.remove("btnGreen")}),IncludePlayerLinkBtnComponent.addEventListener("click",function(){1==(includePlayerLink=(includePlayerLink+1)%2)?IncludePlayerLinkBtnComponent.classList.add("btnGreen"):IncludePlayerLinkBtnComponent.classList.remove("btnGreen")}),dlPngButtonComponent&&(CollectionScreenshotBlock.style.display="initial",TradeScreenshotBlock.style.display="none",dlPngButtonComponent.addEventListener("click",function(){CollectionScreenshotBlock.innerHTML="";let e=a.find(e=>"Downloading"===e["translation-key"])[CurrentLanguageCode],t=dlPngButtonComponent.querySelector("#dl-png-btn-text");t.textContent=e,dlPngButtonComponent.classList.add("btnYellowTransition"),1===ImgOrientationLandscapeZeroPortraitOne?SnapshotAreaBlock.style.width="400px":SnapshotAreaBlock.style.width="1200px",copyToCollectionScreenshot("collection-screenshot");let n="",o="";1===includeIGN&&(n=PlayerIGNInputComponent.value),1===includePlayerLink&&(o=PlayerLinkInputComponent.value);let l=r.find(e=>e.AlbumNo===CurrentAlbumNumber),s=l[`AlbumName${CurrentLanguageCode}`],c=`
    <div id="collection-screenshot-player-info">
      <div id="collection-screenshot-player-name">${n}</div>
      <div id="collection-screenshot-my-album">${s}</div>
      <div id="collection-screenshot-player-link">${o}</div>
    </div>
    `,u=Math.floor(Date.now()/1e3),d=`<div id="collection-screenshot-footer"><div id="collection-screenshot-footer-time">${u}</div><div id="collection-screenshot-footer-link">https://mogotools.web.app/</div></div>`,p=CollectionScreenshotBlock;p.innerHTML=c+p.innerHTML+d,1===ImgOrientationLandscapeZeroPortraitOne&&(document.getElementById("collection-screenshot-footer-time").style.width="50%",document.getElementById("collection-screenshot-footer-link").style.width="50%"),ResizeElementBeforeCapture(CollectionScreenshotBlock),captureScreenshot("collection-screenshot"),CollectionScreenshotBlock.innerHTML="",CollectionScreenshotBlock.style.display="none",setTimeout(function(){let e=a.find(e=>"DownloadSuccessful"===e["translation-key"])[CurrentLanguageCode];t.textContent=e,setTimeout(function(){dlPngButtonComponent.classList.remove("btnYellowTransition");let e=a.find(e=>"DownloadPNGBtnText"===e["translation-key"])[CurrentLanguageCode];t.textContent=e},3e3)},3e3)})),dlTradePngButtonComponent&&dlTradePngButtonComponent.addEventListener("click",function(){CollectionScreenshotBlock.style.display="none",TradeScreenshotBlock.style.display="initial",TradeScreenshotContainerBlock.setAttribute("style",""),ForTradeScreenshotAreaBlock.style.height="",LookingForScreenshotAreaBlock.style.height="",ForTradeScreenshotAreaBlock.innerHTML="",LookingForScreenshotAreaBlock.innerHTML="";let e=a.find(e=>"Downloading"===e["translation-key"])[CurrentLanguageCode],t=dlTradePngButtonComponent.querySelector("#dl-trade-png-btn-text");t.textContent=e,dlTradePngButtonComponent.classList.add("btnYellowTransition"),copyToTradeScreenshot("fortrade-screenshot-area","fortrade"),copyToTradeScreenshot("lookingfor-screenshot-area","lookingfor"),ForTradeScreenshotAreaBlock.style.width="400px",ForTradeScreenshotAreaBlock.style.background="",LookingForScreenshotAreaBlock.style.width="400px",LookingForScreenshotAreaBlock.style.background="",ForTradeScreenshotAreaBlock.innerHTML=ForTradeScreenshotAreaBlock.innerHTML.replace(/sticker-card-container-screenshot/g,"sticker-card-container-screenshot-trade"),LookingForScreenshotAreaBlock.innerHTML=LookingForScreenshotAreaBlock.innerHTML.replace(/sticker-card-container-screenshot/g,"sticker-card-container-screenshot-trade");let r="",n="";1===includeIGN&&(r=PlayerIGNInputComponent.value),1===includePlayerLink&&(n=PlayerLinkInputComponent.value);let o=Math.floor(Date.now()/1e3),l=a.find(e=>"MyTrade"===e["translation-key"])[CurrentLanguageCode];if(document.getElementById("collection-screenshot-player-info")&&document.getElementById("collection-screenshot-footer"))document.getElementById("collection-screenshot-player-info").outerHTML=`
        <div id="collection-screenshot-player-info" style="width: 440px">
        <div id="collection-screenshot-player-name">${r}</div>
        <div id="collection-screenshot-my-album">${l}</div>
        <div id="collection-screenshot-player-link">${n}</div>
      </div>
      `,document.getElementById("collection-screenshot-footer").outerHTML=`
      <div id="collection-screenshot-footer" style="width: 440px"><div id="collection-screenshot-footer-gamever">${o}</div><div id="collection-screenshot-footer-link">https://mogotools.web.app/</div></div>
      `;else{let s=`
      <div id="collection-screenshot-player-info" style="width: 440px">
        <div id="collection-screenshot-player-name">${r}</div>
        <div id="collection-screenshot-my-album">${l}</div>
        <div id="collection-screenshot-player-link">${n}</div>
      </div>
      `,c=`<div id="collection-screenshot-footer" style="width: 440px"><div id="collection-screenshot-footer-gamever">${o}</div><div id="collection-screenshot-footer-link">https://mogotools.web.app/</div></div>`,u=TradeScreenshotBlock;u.innerHTML=s+u.innerHTML+c}0===ImgOrientationLandscapeZeroPortraitOne&&(TradeScreenshotContainerBlock.style.display="flex",TradeScreenshotContainerBlock.style.justifyContent="center",TradeScreenshotContainerBlock.style.columnGap="30px",document.getElementById("collection-screenshot-player-info").style.width="900px",document.getElementById("collection-screenshot-footer").style.width="900px",ForTradeScreenshotAreaBlock.scrollHeight>LookingForScreenshotAreaBlock.scrollHeight?LookingForScreenshotAreaBlock.style.height="100%":ForTradeScreenshotAreaBlock.style.height="100%"),TradeScreenshotBlock.style.background='url("assets/background/Collections_Album_BG.png")',ResizeElementBeforeCapture(TradeScreenshotBlock),captureScreenshot("trade-screenshot"),ForTradeScreenshotAreaBlock.innerHTML="",LookingForScreenshotAreaBlock.innerHTML="",TradeScreenshotBlock.style.display="none",setTimeout(function(){let e=a.find(e=>"DownloadSuccessful"===e["translation-key"])[CurrentLanguageCode];t.textContent=e,setTimeout(function(){dlTradePngButtonComponent.classList.remove("btnYellowTransition");let e=a.find(e=>"DownloadTradePNGBtnText"===e["translation-key"])[CurrentLanguageCode];t.textContent=e},3e3)},3e3)}),ViewportBtnComponent.addEventListener("click",function(){handleViewportBtnClick(!0)}),LayoutBtnComponent.addEventListener("click",function(){handleLayoutThemeBtnClick(!0)}),FilterSortMenuMobileOpenBtn.onclick=function(){FilterSortModal.style.display="block"},FilterSortMenuMobileCloseBtn.onclick=function(){FilterSortModal.style.display="none"},ProgressMenuMobileOpenBtn.onclick=function(){ProgressMenuModal.style.display="block"},ProgressMenuMobileCloseBtn.onclick=function(){ProgressMenuModal.style.display="none"},CurrentFiltersOpenBtn.onclick=function(){CurrentFiltersModal.style.display="block",generateCurrentFiltersModalText()},CurrentFiltersCloseBtn.onclick=function(){CurrentFiltersModal.style.display="none"},ManageProfileOpenBtn.onclick=function(){ManageProfileModal.style.display="block",OpenManageProfileMenu()},ManageProfileCloseBtn.onclick=function(){ManageProfileModal.style.display="none"},BasicMenuMobileOpenBtn.onclick=function(){BasicMenuModal.style.display="block"},BasicMenuWebOpenBtn.onclick=function(){BasicMenuModal.style.display="block"},BasicMenuMobileCloseBtn.onclick=function(){BasicMenuModal.style.display="none"},window.onclick=function(e){e.target===FilterSortModal&&(FilterSortModal.style.display="none"),e.target===ProgressMenuModal&&(ProgressMenuModal.style.display="none"),e.target===BasicMenuModal&&(BasicMenuModal.style.display="none"),e.target===CurrentFiltersModal&&(CurrentFiltersModal.style.display="none"),e.target===ManageProfileModal&&(ManageProfileModal.style.display="none")},GenerateTradePostBtnComponent.addEventListener("click",function(){GenerateTradePostClipboard()}),CopyTradePostAreaBtnComponent.addEventListener("click",copyTradePostAreaToClipboard),ToggleSelectedBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].selected=(userData[t].selected+1)%2,RestoreSelected(userData,e)}),countSelectedStickers()},ResetSparesBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].spare=0,RestoreStickerSpares(userData,e),ChangeUserDataHaveSpareValue(userData,e)}),countVaultStickers()},ToggleLFBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].lookingfor=(userData[t].lookingfor+1)%2,RestoreTradeStates(userData,e)})},ToggleFTBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].fortrade=(userData[t].fortrade+1)%2,RestoreTradeStates(userData,e)})},ResetLFBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].lookingfor=0,RestoreTradeStates(userData,e)})},ResetFTBtnComponent.onclick=function(){let e=document.querySelectorAll(".sticker-card-container");e.forEach(e=>{let t=e.getAttribute("data-global");userData[t].fortrade=0,RestoreTradeStates(userData,e)})},ResetAllStickersBtnComponent.onclick=function(){CreateNewUserData(e),clearFilters();let t=document.querySelectorAll(".sticker-card-container");t.forEach(e=>{RestoreSelected(userData,e),RestoreStickerSpares(userData,e),RestoreTradeStates(userData,e)}),countSelectedStickers(),countVaultStickers(),generateCurrentStickerBoard(e,userData,"current-sticker-board")},LeftoverVaultStarsInputComponent.addEventListener("input",handleVaultPrestigeInput);for(let i=0;i<AccordionElementGroup.length;i++)AccordionElementGroup[i].addEventListener("click",function(){this.classList.toggle("active");let e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"});function handleBasicMenuNavigationClick(e){for(let t=0;t<BasicMenuNavBtnElementGroup.length;t++)BasicMenuNavBtnElementGroup[t].classList.remove("basic-menu-navigation-selected");e.target.classList.add("basic-menu-navigation-selected");let r="";"BasicMenuNewsBtn"===e.target.id?r="news-content":"BasicMenuFAQBtn"===e.target.id?r="faq-info-content":"BasicMenuDisplayBtn"===e.target.id&&(r="display-settings-content");for(let n=0;n<BasicMenuSubcontainerElementGroup.length;n++)BasicMenuSubcontainerElementGroup[n].id===r?BasicMenuSubcontainerElementGroup[n].style.display="initial":BasicMenuSubcontainerElementGroup[n].style.display="none"}for(let k=0;k<BasicMenuNavBtnElementGroup.length;k++)BasicMenuNavBtnElementGroup[k].addEventListener("click",handleBasicMenuNavigationClick);let webBasicMenuImg=document.querySelector(".webBasicMenuImg");function LoadNews(){let e=Math.floor(new Date().getTime()/1e3),t=n.filter(t=>t.NewsTime<=e).sort((e,t)=>t.NewsTime-e.NewsTime);t.forEach(e=>{let{NewsTime:t,NewsHeader:r,NewsContent:n}=e,a=`
      <div class="basic-menu-news-item">
        <div class="basic-menu-news-item-header">
          <span class="news-item-time">${convertEpochToYYYYMMDD(parseInt(t))}</span> - ${r}
        </div>
        <div class="basic-menu-news-item-content">${n}</div>
      </div><br>
    `;NewsContentBlock.innerHTML+=a});let r=t.some(t=>{let{NewsTime:r}=t;return e-r<=86400});r&&(0===WebZeroMobileOne?BasicMenuWebOpenBtn.click():1===WebZeroMobileOne&&BasicMenuMobileOpenBtn.click())}function convertEpochToYYYYMMDD(e){let t=parseInt(e,10),r=new Date(1e3*t),n=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),l=`${n}/${a}/${o}`;return l}function handleChangeStickerStyleBtn(e){!0===e&&(StickerSelectedZeroShowOneBack=(StickerSelectedZeroShowOneBack+1)%2),ChangeStickerStyleBtnTextSpan.setAttribute("data-translation-key",`ChangeStickerStyleBtnText_${StickerSelectedZeroShowOneBack}`),translateLanguage(CurrentLanguageCode,`ChangeStickerStyleBtnText_${StickerSelectedZeroShowOneBack}`)}function translateLanguage(e,t){let r=document.querySelectorAll("[data-translation-key]");r.forEach(r=>{let n=r.dataset.translationKey;if(n===t){let o=a.find(e=>e["translation-key"]===n),l=o?o[e]:"";"TEXTAREA"===r.tagName?r.placeholder=l:"INPUT"===r.tagName?r.placeholder=l:r.textContent=l}})}function TranslateSetName(e){let r=document.querySelectorAll("span.SetNameText[data-setid]");r.forEach(r=>{let n=r.getAttribute("data-setid"),a=t.find(e=>e.SetID===n);if(a&&r.classList.contains("SetNameText")){let o=a[`SetName${e}`];r.textContent=o;let l="set-name";o.length>=15?l="set-name-long-min15":o.length>=18&&(l="set-name-long-min18"),isBrighterThan(a.Colour,"#CCCCCC")&&(l+="-dark"),r.parentElement.className=l}})}function TranslateStickerName(t,r){let n=t.querySelector("span.StickerNameText[data-stickerid]"),a=n.getAttribute("data-stickerid"),o=e.find(e=>e.GlobalID===a);if(o&&n.classList.contains("StickerNameText")){let l=o[`StickerName${r}`];n.textContent=l;let s="sticker-name";l.length>=14?s="sticker-name-long-min14":l.length>=18&&(s="sticker-name-long-min18"),isBrighterThan(o.Colour,"#CCCCCC")&&(s+="-dark"),n.parentElement.className=s}}function GenerateChangeAlbumButtons(){r.forEach(e=>{let t=document.createElement("button");t.classList.add("change-album-btn","btn"),t.setAttribute("type","button"),t.setAttribute("data-album-number",e.AlbumNo);let r=`
      <span><span data-translation-key="album"></span>&nbsp;${e.AlbumNo}</span>
    `;t.innerHTML=r,ChangeAlbumMenuBlock.appendChild(t)}),translateLanguage(CurrentLanguageCode,"album");let t=document.querySelectorAll(".change-album-btn");t.forEach(r=>{r.addEventListener("mousedown",()=>{r.classList.add("scale-down"),r.classList.add("btnYellowTransition")}),r.addEventListener("mouseup",()=>{r.classList.remove("scale-down"),r.classList.remove("btnYellowTransition")}),r.addEventListener("mouseleave",()=>{r.classList.remove("scale-down"),r.classList.remove("btnYellowTransition")}),r.addEventListener("touchstart",()=>{r.classList.add("scale-down"),r.classList.add("btnYellowTransition")}),r.addEventListener("touchend",()=>{r.classList.remove("scale-down"),r.classList.remove("btnYellowTransition")}),r.addEventListener("click",function(){clearFilters(),ResetAllStickersBtnComponent.click(),1===IgnorePrestige&&IgnorePrestigeBtnComponent.click(),CurrentAlbumNumber=this.dataset.albumNumber,CurrentStickerBoardBlock.innerHTML="",CreateNewUserData(e),GenerateFilterSetButtons(),SetDefaultFilterStates(),generateCurrentStickerBoard(e,userData,"current-sticker-board"),document.querySelector(`button[data-translation-pointer= ${CurrentLanguageCode}]`).click(),PerformSort({currentTarget:document.querySelector("button[data-sort-type='GlobalID']")}),NotSelectedByDefault(),UpdateTotalStickerQuantity(),UpdateTotalStickerByRarityQuantity(),countSelectedStickers(),countVaultStickers(),endDateTime=UpdateAlbumStartEndTime(),t.forEach(e=>e.classList.remove("btnBlue")),this.classList.add("btnBlue")})})}function SaveToProfileList(){let e=Date.now(),t=PlayerIGNInputComponent.value,r=PlayerLinkInputComponent.value,n=LeftoverVaultStarsInputComponent.value,a=(IgnorePrestige+1)%2,o={ProfileAlbumNumber:CurrentAlbumNumber,ProfileIsPrestige:a,ProfilePlayerIGN:t,ProfilePlayerLink:r,ProfileLeftoverVaultStars:n,ProfileLastModifiedTime:e,ProfileUserData:userData};UserProfileList.push(o),localStorage.setItem("UserProfileList",JSON.stringify(UserProfileList)),UserProfileList.sort((e,t)=>t.ProfileLastModifiedTime-e.ProfileLastModifiedTime),console.log(UserProfileList)}function OpenManageProfileMenu(){UserProfileList.sort((e,t)=>t.ProfileLastModifiedTime-e.ProfileLastModifiedTime),ProfileListBlock.innerHTML="",UserProfileList.forEach(e=>{let t=e.ProfileAlbumNumber,n=e.ProfileIsPrestige,a="";1===n?a="Yes":(n=0,a="No");let o=e.ProfilePlayerIGN,l=convertEpochToYYYYMMDDHHMMSS(parseInt(e.ProfileLastModifiedTime)),s=r.find(e=>e.AlbumNo===t),c=s[`AlbumName${CurrentLanguageCode}`],u=s.Colour,d=UserProfileList.indexOf(e)+1,p=`
      <div class="profile-block" data-profile-time="${e.ProfileLastModifiedTime}">
        <div class="profile-info-container">
          <div class="profile-info-container-name">【${d}】&emsp;${o}</div>
          <div class="profile-info-container-album" style="background-color: ${u}"><span data-translation-key="album"></span>&nbsp;${t} - ${c}</div>
          <div class="profile-info-container-prestige"><span><span data-translation-key="IsPrestige"></span>&emsp;</span><span data-translation-key="${a}"></span></div>
          <div class="profile-info-container-time"><span><span data-translation-key="LastModified"></span>&emsp;</span>${l}</div>
        </div>
        <div class="profile-options-container">
          <button class="btn profile-options-btn btnYellow LoadProfileBtn"><span data-translation-key="LoadProfileButtonText"></span></button>
          <button class="btn profile-options-btn btnGreen DownloadProfileBtn"><span data-translation-key="DownloadProfileButtonText"></span></button>
          <button class="btn profile-options-btn btnRed DeleteProfileBtn"><span data-translation-key="DeleteProfileButtonText"></span></button>
        </div>
      </div>
    `;ProfileListBlock.innerHTML+=p,translateLanguage(CurrentLanguageCode,a)}),translateLanguage(CurrentLanguageCode,"album"),translateLanguage(CurrentLanguageCode,"LoadProfileButtonText"),translateLanguage(CurrentLanguageCode,"DownloadProfileButtonText"),translateLanguage(CurrentLanguageCode,"DeleteProfileButtonText"),translateLanguage(CurrentLanguageCode,"LastModified"),translateLanguage(CurrentLanguageCode,"IsPrestige");let e=document.querySelectorAll(".profile-options-btn");e.forEach(e=>{e.addEventListener("mousedown",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("mouseup",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("mouseleave",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")}),e.addEventListener("touchstart",()=>{e.classList.add("scale-down"),e.classList.add("btnYellowTransition")}),e.addEventListener("touchend",()=>{e.classList.remove("scale-down"),e.classList.remove("btnYellowTransition")})})}function convertEpochToYYYYMMDDHHMMSS(e){let t=new Date(e),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${r}/${n}/${a} ${o}:${l}:${s}`}webBasicMenuImg&&(webBasicMenuImg.addEventListener("mousedown",()=>{webBasicMenuImg.classList.add("scale-down")}),webBasicMenuImg.addEventListener("mouseup",()=>{webBasicMenuImg.classList.remove("scale-down")}),webBasicMenuImg.addEventListener("mouseleave",()=>{webBasicMenuImg.classList.remove("scale-down")}),webBasicMenuImg.addEventListener("touchstart",()=>{webBasicMenuImg.classList.add("scale-down")}),webBasicMenuImg.addEventListener("touchend",()=>{webBasicMenuImg.classList.remove("scale-down")})),ChangeStickerStyleBtnComponent.addEventListener("click",function(){handleChangeStickerStyleBtn(!0);let e=document.querySelectorAll(".sticker-card-container"),t=Array.from(e).filter(function(e){let t=e.getAttribute("data-global");return 0===userData[t].selected});t.forEach(function(e){ApplySelectedStyle(e)})}),document.addEventListener("click",function(e){let t=e.target.closest(".set-logo");if(t){let r=parseInt(t.getAttribute("data-setidnumber")),n=Array.from(document.querySelectorAll(".sticker-card-container[data-global]")).find(function(e){let t=e.getAttribute("data-global");return Math.floor(t/100)===r});n&&n.scrollIntoView({behavior:"smooth"})}}),document.addEventListener("mousedown",function(e){e.target.classList.contains("set-logo")&&e.target.classList.add("scale-down")}),document.addEventListener("mouseup",function(e){e.target.classList.contains("set-logo")&&e.target.classList.remove("scale-down")}),document.addEventListener("mouseleave",function(e){e.target.classList.contains("set-logo")&&e.target.classList.remove("scale-down")}),document.addEventListener("touchstart",function(e){e.target.classList.contains("set-logo")&&e.target.classList.add("scale-down")}),document.addEventListener("touchend",function(e){e.target.classList.contains("set-logo")&&e.target.classList.remove("scale-down")}),LanguageButtons.forEach(e=>{e.addEventListener("click",function(){let e=this.dataset.translationPointer;CurrentLanguageCode=e,TranslationElements.forEach(e=>{let t=e.dataset.translationKey;translateLanguage(CurrentLanguageCode,t)}),LanguageButtons.forEach(e=>e.classList.remove("btnBlue")),this.classList.add("btnBlue"),countVaultStickers(),generateCurrentFiltersModalText(),document.querySelectorAll(".sticker-card-container").forEach(e=>{TranslateStickerName(e,CurrentLanguageCode)}),translateLanguage(CurrentLanguageCode,"set"),translateLanguage(CurrentLanguageCode,"album"),translateLanguage(CurrentLanguageCode,"SpareLabel"),TranslateSetName(CurrentLanguageCode)})}),ManageProfileImg&&(ManageProfileImg.addEventListener("mousedown",()=>{ManageProfileImg.classList.add("scale-down")}),ManageProfileImg.addEventListener("mouseup",()=>{ManageProfileImg.classList.remove("scale-down")}),ManageProfileImg.addEventListener("mouseleave",()=>{ManageProfileImg.classList.remove("scale-down")}),ManageProfileImg.addEventListener("touchstart",()=>{ManageProfileImg.classList.add("scale-down")}),ManageProfileImg.addEventListener("touchend",()=>{ManageProfileImg.classList.remove("scale-down")})),document.addEventListener("click",function(e){let t=e.target.closest(".DownloadProfileBtn");if(t){let n=t.closest(".profile-block"),a=n.getAttribute("data-profile-time"),o=UserProfileList.findIndex(e=>parseInt(e.ProfileLastModifiedTime)===parseInt(a));if(-1!==o){let l=UserProfileList[o],s=UserProfileList[o].ProfileUserData;Object.keys(s).forEach(e=>{s[e].spare=parseInt(s[e].spare),s[e]={...defaultValues,...s[e]}});let c=l.ProfilePlayerIGN,u=l.ProfilePlayerLink,d=l.ProfileLeftoverVaultStars,p=[`CurrentAlbumNumber: ${l.ProfileAlbumNumber}`,`IsPrestige: ${l.ProfileIsPrestige}`,`player-ign: ${c}`,`player-link: ${u}`,`leftover-vault-stars: ${d}`,],g=JSON.stringify(s,null,2),m=p.join("\n")+"\n"+g,f=new Blob([m],{type:"text/plain"}),S=URL.createObjectURL(f),y=document.createElement("a"),b=new Date(l.ProfileLastModifiedTime),C=b.getFullYear(),B=String(b.getMonth()+1).padStart(2,"0"),L=String(b.getDate()).padStart(2,"0"),h=String(b.getHours()).padStart(2,"0"),T=String(b.getMinutes()).padStart(2,"0"),$=String(b.getSeconds()).padStart(2,"0"),v=r.find(e=>e.AlbumNo===l.ProfileAlbumNumber),I=v[`AlbumName${CurrentLanguageCode}`].replace(/\s/g,"");y.download=`mogotools-userData_${I}_${C}${B}${L}_${h}${T}${$}.txt`,y.href=S,y.click()}}}),document.addEventListener("click",function(e){let t=e.target.closest(".DeleteProfileBtn");if(t){let r=t.closest(".profile-block"),n=r.getAttribute("data-profile-time"),a=UserProfileList.findIndex(e=>parseInt(e.ProfileLastModifiedTime)===parseInt(n));console.log(n),-1!==a&&(UserProfileList.splice(a,1),localStorage.setItem("UserProfileList",JSON.stringify(UserProfileList)),OpenManageProfileMenu())}}),document.addEventListener("click",function(t){var r=t.target.closest(".LoadProfileBtn");if(r){let n=r.closest(".profile-block"),a=n.getAttribute("data-profile-time"),o=UserProfileList.findIndex(e=>parseInt(e.ProfileLastModifiedTime)===parseInt(a));if(-1!==o){clearFilters(),ResetAllStickersBtnComponent.click();let l=UserProfileList[o],s=UserProfileList[o].ProfileUserData;CurrentAlbumNumber=l.ProfileAlbumNumber,PlayerIGNInputComponent.value=l.ProfilePlayerIGN,PlayerLinkInputComponent.value=l.ProfilePlayerLink,LeftoverVaultStarsInputComponent.value=l.ProfileLeftoverVaultStars,Object.keys(userData=s).forEach(t=>{let{id:r,...n}=userData[t];parseInt(e.find(e=>e.GlobalID===r).AlbumNo)!==parseInt(CurrentAlbumNumber)?delete userData[t]:userData[t]={id:r,...Object.fromEntries(Object.entries(n).map(([e,t])=>[e,parseInt(t)]))}}),CurrentStickerBoardBlock.innerHTML="",GenerateFilterSetButtons(),SetDefaultFilterStates(),generateCurrentStickerBoard(e,userData,"current-sticker-board"),document.querySelector(`button[data-translation-pointer= ${CurrentLanguageCode}]`).click(),PerformSort({currentTarget:document.querySelector("button[data-sort-type='GlobalID']")}),NotSelectedByDefault(),l.ProfileIsPrestige===IgnorePrestige&&IgnorePrestigeBtnComponent.click(),UpdateTotalStickerQuantity(),UpdateTotalStickerByRarityQuantity(),countSelectedStickers(),countVaultStickers(),endDateTime=UpdateAlbumStartEndTime(),exportUserData(!1);let c=document.querySelectorAll(".change-album-btn");c.forEach(e=>{e.getAttribute("data-album-number")===CurrentAlbumNumber?e.classList.add("btnBlue"):e.classList.remove("btnBlue")}),ManageProfileModal.style.display="none"}}});